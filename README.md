### **GitHub**

```bash
git clone https://github.com/Sweekar07/filehub

git checkout main
```

> [!IMPORTANT] Branch
> > The local development setup is available in `main` branch only.
> 
> **Branch:** main
> 
> Make sure to switch to `main` branch.


### **Docker Command**

- Build and Start the container:
```bash
docker compose -f docker-compose.local.yml up --build
```
- Stop the container:
```bash
docker compose -f docker-compose.local.yml down
```

### **OpenFGA CLI code**

#### Basic Command Breakdown

- **`docker compose -f docker-compose.local.yml`**: Specifies the Docker Compose file to use.
- **`run --rm`**: Runs the command in a temporary container that is removed after execution.
- **`openfga-cli`**: The OpenFGA CLI service defined in your Docker Compose file.
- **`--api-token=key1`**: The API token for authenticating with the OpenFGA server.

#### **Create Store**

- Command:
```bash
docker compose -f docker-compose.local.yml run --rm openfga-cli --api-token=key1 store create --name="FileHub"
```

- Output:
```bash
{
  "store": {
    "created_at":"2025-12-17T15:14:27.312857Z",
    "id":"01KCPE0YBDZH4ATPY1M7270DVC",
    "name":"FileHub",
    "updated_at":"2025-12-17T15:14:27.312857Z"
  }
}
```


> [!IMPORTANT] Store ID
> > Fetch the `store.id` from the output above. This ID is required for configuring the Django environment variables.
> 
> **Store ID:** `01KCPE0YBDZH4ATPY1M7270DVC`
> 
> Make sure to copy this ID and **replace** it to your Django environment variables as `FGA_STORE_ID`.

#### **Write Model for Store**

- command:
```bash
docker compose -f docker-compose.local.yml run --rm openfga-cli --api-token=key1 model write --store-id=01KCPE0YBDZH4ATPY1M7270DVC --file=data/filehub/first-model.fga
```

- output::
```bash
{
  "authorization_model_id":"01KCPEZGSQQN3QPP77GST6T129"
}
```

> [!IMPORTANT] Model Authorization ID
> > Fetch the `` from the output above. This ID is required for configuring the Django environment variables.
> 
> **Model Authorization ID:** `01KCPEZGSQQN3QPP77GST6T129`
> 
> Make sure to copy this ID and **replace** it to your Django environment variables as `FGA_AUTHZ_MODEL_ID`.


### **Env Files**

#### **.envs/.local/.env.postgres**
```
POSTGRES_DB=openfga
POSTGRES_USER=openfga
POSTGRES_PASSWORD=openfga
```

#### **.envs/.local/.env.openfga**
```
# Auth
OPENFGA_AUTHN_METHOD=preshared
OPENFGA_AUTHN_PRESHARED_KEYS=key1,key2

# Datastore
OPENFGA_DATASTORE_ENGINE=postgres
OPENFGA_DATASTORE_URI=postgres://openfga:openfga@openfga-postgres:5432/openfga?sslmode=disable

# Optional
OPENFGA_LOG_LEVEL=info
OPENFGA_LOG_FORMAT=json
```

#### **.envs/.local/.env.django**
```
DJANGO_SECRET_KEY='s9+ky=7_iw568bl^=&lt=u+qef42kz$eg15g!x*&)-mg&4cf5x'
DEBUG=True
DJANGO_LOGLEVEL=info
DJANGO_ALLOWED_HOSTS=localhost

DATABASE_ENGINE=postgresql_psycopg2
DATABASE_NAME=openfga
DATABASE_USERNAME=openfga
DATABASE_PASSWORD=openfga
DATABASE_HOST=postgres
DATABASE_PORT=5432

FGA_API_URL=http://openfga:8080
FGA_API_TOKEN=key1
FGA_STORE_ID=01KCHFZ97681C91WBDPPY303AT      # Replace with the Store ID generated by OpenFGA
FGA_AUTHZ_MODEL_ID=01KCK13Z9V4F5SEBX9J67HJJGF       # Replace with the Authorization Model ID generated by OpenFGA
```

> [!IMPORTANT] Restart the docker Container
> > Need to restart the docker containers since environment variables are changed now.
> 
> Refer above **Docker Command** to stop and start the containers again.

### **Django Super User**

- command:
```bash
docker exec -it django-docker python manage.py createsuperuser
```

Enter your name, email and password.
